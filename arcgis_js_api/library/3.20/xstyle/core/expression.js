//>>built
define("xstyle/core/expression",["xstyle/core/utils","xstyle/core/Definition"],function(n,t){function u(c,e){var f=e[0];return f&&c?(f=x(f),u(c.property?c.property(f):c[f],e.slice(1))):c}function v(c,e,f){if(y(e,c)){var b={};b[c]=function(a){for(var b=[],d=0,g=e.length;d<g;d++){var h=e[d];h&&"function"==typeof h[c]&&(h=h[c](a));b[d]=h}return f(b)};return b}return f(e)}function r(c,e){return{apply:function(d,b,a){for(var f=0,m=b.length;f<m;f++){var g=b[f];g.dependencyOf&&g.dependencyOf(a)}f=function(){var h=
[];if(c.selfExecuting)return c.apply(d,b,a);for(var e=0,f=b.length;e<f;e++)h[e]=b[e].valueOf();if(c.selfWaiting)return c.apply(d,h,a);h.push(d);return n.whenAll(h,function(b){var e=b.pop();return v("forRule",b,function(b){return v("forElement",b,function(b){return c.apply(e,b,a)})})})};f.reverse=function(a){return e(a,b)};return f}}}function p(c){return w[c]||(w[c]=new Function("a","b","return "+c))}function d(c,e,d,b,a){function f(b){b.skipResolve=!0;b.precedence=e;b.infix=!1!==a}var n=function(c,
e){var d=e[0],f=e[1];if(d&&d.put)f=b(c,f&&f.valueOf()),f!==z&&d.put(f);else if(f&&f.put)f.put(a(c,d&&d.valueOf()));else throw new TypeError("Can not put");},g={apply:function(e,g,l){var h;d=p(d);b=b&&p(b);a=a&&p(a);m[c]=h=r(d,n);f(h);return h.apply(e,g,l)}};f(g);m[c]=g}function q(d,e){function f(a){for(;p<=a.precedence;){var b=g.pop(),d=m[g.pop()],c=new t;c.setCompute(d.apply(null,d.infix?[g.pop(),b]:[b],c));h=g.length?g[g.length-1]:void 0;g.push(c);p=h&&m[h]&&m[h].precedence}}var b,a;e=e.join?e.slice():
[e];for(b=0;b<e.length;b++)if(a=e[b],"string"==typeof a){var c=a.match(/"[^\"]*"|[+\-<>\|\/\?\:^*!&|]+|[\w_$\.\/-]+/g);a=[b,1];c&&a.push.apply(a,c);e.splice.apply(e,a);b+=a.length-3}var p,g=[],h,c={};for(b=0;b<e.length;b++){a=e[b];if("("==a.operator){var k=g[g.length-1];void 0===k||m.hasOwnProperty(k)?a=q(d,a.getArgs()[0]):(g.pop(),a=function(a,b){function c(c){return n.when(a.valueOf(),function(h){var l=a.parent&&a.parent.valueOf();if(!h.selfResolving){if(!e){e=[];for(var k=0,m=b.length;k<m;k++)e[k]=
q(d,b[k]);f=h.selfReacting?h.apply(l,e,g):r(h).apply(l,e,g)}return f()}h=h.apply(l,b,g);return c?h:h.valueOf()})}var e,f,g=new t(c);g.setReverseCompute(function(){var a=arguments;return n.when(c(!0),function(b){return b.put.apply(b,a)})});return g}(k,a.getArgs()))}else if(m.hasOwnProperty(a))k=m[a],f(k),p=(h||k).precedence;else if(-1<a)a=+a;else if(a.isLiteralString)a=a.value;else{a=a.split(/\s*\/\s*/);var k=a[0],l=d.getDefinition(k);if("string"==typeof l||l instanceof Array)l=q(d,l);else if(void 0===
l)throw Error('Could not find reference "'+k+'"');c[k]=l;1<a.length&&(l=u(l,a.slice(1)));a=l}g.push(a)}f({precedence:100});if(1<g.length)throw Error("Could not reduce expression");a=g[0];a.inputs=c;return a}var x=n.convertCssNameToJs,y=n.someHasProperty,z={},w={},m={};d("+",6,"a+b","a-b","a-b");d("-",6,"a-b","a+b","b-a");d("*",5,"a*b","a/b","a/b");d("/",5,"a/b","a*b","b/a");d("?",16,"b[a?0:1]","a\x3d\x3d\x3db[0]||(a\x3d\x3d\x3db[1]?false:deny)","[a,b]");d(":",15,"[a,b]","a[0]?a[1]:deny","a[1]");d("!",
4,"!a","!a",!1);d("%",5,"a%b");d("\x3e",8,"a\x3eb");d("\x3e\x3d",8,"a\x3e\x3db");d("\x3c",8,"a\x3cb");d("\x3c\x3d",8,"a\x3c\x3db");d("\x3d\x3d",9,"a\x3d\x3d\x3db");d("\x26",8,"a\x26\x26b");d("|",8,"a||b");return{react:r,evaluate:q,selfResolving:function(c){c.selfResolving=!0;return c}}});