// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.20/esri/copyright.txt for details.
//>>built
define("esri/tasks/DirectionsFeatureSet","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/json ../kernel ../geometry/Extent ../geometry/Polyline ../geometry/Point ../graphic ./FeatureSet".split(" "),function(e,n,k,w,x,y,z,u,A,B,C){e=e(C,{declaredClass:"esri.tasks.DirectionsFeatureSet",constructor:function(p,t){this.routeId=p.routeId;this.routeName=p.routeName;n.mixin(this,p.summary);this.extent=new z(this.envelope);var f=this._fromCompressedGeometry,l=this.features,g=this.extent.spatialReference,
b=[];k.forEach(t,function(r,a){l[a].setGeometry(b[a]=r?f(r,g):l[a].geometry)});this.mergedGeometry=this._mergePolylinesToSinglePath(b,g);this.geometryType="esriGeometryPolyline";k.forEach(p.events,function(b,a){k.forEach(b,function(a,c){b[c]=new B(new A(a.point.x,a.point.y,g),null,{ETA:a.ETA,strings:x.stringify(a.strings),arriveTimeUTC:a.arriveTimeUTC})});p.events[a]=b});delete this.envelope},_fromCompressedGeometry:function(p,t){var f=0,l=0,g=0,b=0,r=[],a,h,c,e,n,v,d=0,m=0,q=0;(c=p.match(/((\+|\-)[^\+\-\|]+|\|)/g))||
(c=[]);0===parseInt(c[d],32)?(d=2,a=parseInt(c[d],32),d++,e=parseInt(c[d],32),d++,a&1&&(m=k.indexOf(c,"|")+1,n=parseInt(c[m],32),m++),a&2&&(q=k.indexOf(c,"|",m)+1,v=parseInt(c[q],32),q++)):(e=parseInt(c[d],32),d++);for(;d<c.length&&"|"!==c[d];)a=parseInt(c[d],32)+f,d++,f=a,h=parseInt(c[d],32)+l,d++,l=h,a=[a/e,h/e],m&&(h=parseInt(c[m],32)+g,m++,g=h,a.push(h/n)),q&&(h=parseInt(c[q],32)+b,q++,b=h,a.push(h/v)),r.push(a);f=new u({paths:[r],hasZ:0<m,hasM:0<q});f.setSpatialReference(t);return f},_mergePolylinesToSinglePath:function(e,
n){var f=[];k.forEach(e,function(b){k.forEach(b.paths,function(b){f=f.concat(b)})});var l=[],g=[0,0];k.forEach(f,function(b){if(b[0]!==g[0]||b[1]!==g[1])l.push(b),g=b});return(new u({paths:[l]})).setSpatialReference(n)}});w("extend-esri")&&n.setObject("tasks.DirectionsFeatureSet",e,y);return e});