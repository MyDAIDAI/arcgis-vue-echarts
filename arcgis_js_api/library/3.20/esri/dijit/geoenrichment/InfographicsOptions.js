// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.20/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/InfographicsOptions","../../declare dojo/_base/lang dojo/Deferred dojo/string ../../tasks/geoenrichment/studyAreaOptionsFromJson ../../tasks/geoenrichment/GeoenrichmentTask ./lang ./config ./InfographicsOptionsItem".split(" "),function(k,z,A,F,B,C,m,p,w){function D(a,c){var b=parseFloat(a.index),e=parseFloat(c.index);return isNaN(b)&&isNaN(e)?0:isNaN(b)?1:isNaN(e)?-1:b-e}function x(a,c){for(var b=0;b<a.length;b++){var e=a[b];if(e.type==c.type&&m.arraysEqual(e.variables,
c.variables))return{report:e,index:b}}return null}function q(a,c){if(a)for(var b in a)if(a.hasOwnProperty(b)){c[b]=[];for(var e=0;e<a[b].length;e++){var g={};y(a[b][e],g);c[b].push(g)}}}function y(a,c){c.type=a.type||("OneVarMultiComparison"==a.report?"OneVar":a.report);if(a.dataCollection)if(a.vars){c.variables=[];for(var b=0;b<a.vars.length;b++)c.variables.push(a.dataCollection+"."+a.vars[b])}else c.variables=[a.dataCollection+".*"];else c.variables=a.variables;m.isBoolean(a.isVisible)?c.isVisible=
a.isVisible:m.isBoolean(a.checked)&&(c.isVisible=a.checked)}k=k("esri.dijit.geoenrichment.InfographicsOptions",null,{_items:null,_loaded:null,studyAreaOptions:null,theme:"common",constructor:function(a){this._loaded={};this.studyAreaOptions=B(a&&(a.buffer||a.studyAreaOptions));this._items={};a&&(q(a.reports||a.items,this._items),a.theme&&(this.theme=a.theme))},toJson:function(){var a={};q(this._items,a);return{studyAreaOptions:this.studyAreaOptions.toJson(),items:a,theme:this.theme}},getItems:function(a){var c=
new A;if(this._loaded[a])c.resolve(this._items[a]);else{var b=new C(p.server);b.token=p.token;b.getDataCollections(a,null,["id","alias"]).then(z.hitch(this,this._mergeItems,a,c),function(a){c.reject(a)})}return c.promise},_mergeItems:function(a,c,b){try{var e={AgePyramid:1,TapestryNEW:1,RelatedVariables:1,OneVar:1},g={TapestryNEW:"Tapestry"},d,n,l=[];for(d=0;d<b.length;d++){var k=b[d].metadata.infographics||b[d].metadata.infographics2;if(k){var r=JSON.parse(k),h;for(h in r)if(e[h]){var m=h;g[h]&&
(m=g[h]);var t=new w(m,[b[d].id+".*"]),u;for(u in r[h])r[h].hasOwnProperty(u)&&(t[u]=r[h][u]);(n=x(l,t))?l[n.index]=t:l.push(t)}}}var v,f=this._items[a];f||(f=[],f.push(new w("OneVar",["KeyGlobalFacts.AVGHHSZ"])),this._items[a]=f);for(d=f.length-1;0<=d;d--)if(n=x(l,f[d]))y(f[d],n.report),f[d]=n.report,l.splice(n.index,1);else{if("OneVar"==f[d].type&&1==f[d].variables.length){var p,q=f[d].variables[0];if(!v)for(v={},e=0;e<b.length;e++)for(g=0;g<b[e].variables.length;g++)v[b[e].id+"."+b[e].variables[g].id]=
b[e].variables[g];if(p=v[q]){f[d].title=p.alias;continue}}f.splice(d,1);d--}for(d=0;d<l.length;d++)f.push(l[d]);f.sort(D);this._loaded[a]=!0;c.resolve(f)}catch(E){c.reject(E)}}});k.Item=w;return k});